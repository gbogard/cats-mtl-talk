<!DOCTYPE html><html lang="fr-FR"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><style>.bespoke-marp-note,.bespoke-marp-osc,.bespoke-progress-parent{display:none;-webkit-transition:none;transition:none}@media screen{body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:0;color:inherit;cursor:pointer;font-size:inherit;opacity:.8;outline:none;padding:0;-webkit-transition:opacity .2s linear;transition:opacity .2s linear;-webkit-tap-highlight-color:transparent}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:disabled{cursor:not-allowed;opacity:.15!important}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover{opacity:1}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:active{opacity:.6}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:not(:disabled){-webkit-transition:none;transition:none}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-prev{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNNjggOTBMMjggNTBsNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-next{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNMzIgOTBsNDAtNDAtNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen]{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB4PSIxMCIgeT0iMjAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgcng9IjUuNjciLz48cGF0aCBjbGFzcz0iYSIgZD0iTTQwIDcwSDIwVjUwbTIwIDBMMjAgNzBtNDAtNDBoMjB2MjBtLTIwIDBsMjAtMjAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen]{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB4PSIxMCIgeT0iMjAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgcng9IjUuNjciLz48cGF0aCBjbGFzcz0iYSIgZD0iTTIwIDUwaDIwdjIwbS0yMCAwbDIwLTIwbTQwIDBINjBWMzBtMjAgMEw2MCA1MCIvPjwvc3ZnPg==")}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter]{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS13aWR0aDo1cHh9PC9zdHlsZT48L2RlZnM+PHBhdGggY2xhc3M9ImEiIGQ9Ik0yMCA2MGgtNWE1IDUgMCAwMS01LTVWMjBhNSA1IDAgMDE1LTVoNjBhNSA1IDAgMDE1IDV2NU0zMCA4NWg2MCIvPjxyZWN0IHg9IjMwIiB5PSIzNSIgd2lkdGg9IjYwIiBoZWlnaHQ9IjQwIiByeD0iNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZmIi8+PHJlY3QgY2xhc3M9ImEiIHg9IjMwIiB5PSIzNSIgd2lkdGg9IjYwIiBoZWlnaHQ9IjQwIiByeD0iNSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNNDAgNTBoNDBNNDAgNjBoMzAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body,html{height:100%;margin:0}body{background:#000;overflow:hidden}svg.bespoke-marp-slide{opacity:0;pointer-events:none;z-index:-1}svg.bespoke-marp-slide.bespoke-marp-active{opacity:1;pointer-events:auto;z-index:0}svg.bespoke-marp-slide[data-bespoke-marp-load=hideable]{display:none}svg.bespoke-marp-slide[data-bespoke-marp-load=hideable].bespoke-marp-active{display:block}[data-bespoke-marp-fragment=inactive]{visibility:hidden}body[data-bespoke-view=""] .bespoke-marp-parent,body[data-bespoke-view=next] .bespoke-marp-parent{bottom:0;left:0;position:absolute;right:0;top:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc{background:rgba(0,0,0,.65);border-radius:7px;bottom:50px;color:#fff;display:block;font-family:Helvetica,Arial,sans-serif;font-size:16px;left:50%;line-height:0;opacity:1;padding:12px;position:absolute;touch-action:manipulation;-webkit-transform:translateX(-50%);transform:translateX(-50%);-webkit-transition:opacity .2s linear;transition:opacity .2s linear;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap;z-index:1;will-change:transform}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>*,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>*{margin-left:6px}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>:first-child,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>:first-child{margin-left:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span{opacity:.8}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page]{display:inline-block;min-width:140px;text-align:center}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev]{height:32px;line-height:32px;width:32px}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive{cursor:none}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc{opacity:0;pointer-events:none}body[data-bespoke-view=""] svg.bespoke-marp-slide,body[data-bespoke-view=next] svg.bespoke-marp-slide{height:100%;left:0;position:absolute;top:0;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent{background:#222;display:-webkit-box;display:flex;height:5px;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent+.bespoke-marp-parent{top:5px}body[data-bespoke-view=""] .bespoke-progress-parent .bespoke-progress-bar{-webkit-box-flex:0;flex:0 0 0;background:#0288d1;-webkit-transition:-webkit-flex-basis .2s cubic-bezier(0,1,1,1);transition:-webkit-flex-basis .2s cubic-bezier(0,1,1,1);transition:flex-basis .2s cubic-bezier(0,1,1,1);transition:flex-basis .2s cubic-bezier(0,1,1,1),-webkit-flex-basis .2s cubic-bezier(0,1,1,1)}body[data-bespoke-view=next]{background:transparent}body[data-bespoke-view=presenter]{background:#161616}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container{height:100%;left:0;position:absolute;top:0;width:100%;display:grid;grid-template-columns:2fr 1fr;grid-template-rows:minmax(140px,1fr) 2fr 3em;grid-template-areas:"current next" "current note" "info    note"}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent{grid-area:current;position:relative;overflow:hidden}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide{height:calc(100% - 40px);left:20px;position:absolute;pointer-events:none;top:20px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide.bespoke-marp-active{-webkit-filter:drop-shadow(0 3px 10px rgba(0,0,0,.5));filter:drop-shadow(0 3px 10px rgba(0,0,0,.5))}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container{background:#222;cursor:pointer;display:none;grid-area:next;overflow:hidden;position:relative}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container iframe.bespoke-marp-presenter-next{background:transparent;border:0;display:block;-webkit-filter:drop-shadow(0 3px 10px rgba(0,0,0,.5));filter:drop-shadow(0 3px 10px rgba(0,0,0,.5));height:calc(100% - 40px);left:20px;position:absolute;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;top:20px;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container{background:#222;color:#ddd;grid-area:note}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note{margin:20px;width:calc(100% - 40px);height:calc(100% - 40px);box-sizing:border-box;overflow:auto;padding-right:3px;white-space:pre-wrap;word-wrap:break-word;scrollbar-width:thin;scrollbar-color:hsla(0,0%,86.7%,.5) transparent}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar{width:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-track{background:transparent}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-thumb{background:hsla(0,0%,86.7%,.5);border-radius:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note:empty{pointer-events:none}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:first-child{margin-top:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:last-child{margin-bottom:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container{-webkit-box-align:center;align-items:center;box-sizing:border-box;color:#ddd;display:-webkit-box;display:flex;flex-wrap:nowrap;grid-area:info;-webkit-box-pack:center;justify-content:center;padding:0 10px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{display:block;box-sizing:border-box;padding:0 10px;white-space:nowrap;width:100%}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button{height:1.5em;line-height:1.5em;width:1.5em}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page{-webkit-box-ordinal-group:3;order:2;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page .bespoke-marp-presenter-info-page-text{display:inline-block;min-width:120px;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time{color:#999;-webkit-box-ordinal-group:2;order:1;text-align:left}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{color:#999;-webkit-box-ordinal-group:4;order:3;text-align:right}}@media print{.bespoke-marp-presenter-info-container,.bespoke-marp-presenter-next-container,.bespoke-marp-presenter-note-container{display:none}}</style><style>@charset "UTF-8";@import url("https://fonts.googleapis.com/css?family=Lato:400,900|Roboto+Mono:400,700&display=swap");div#p>svg>foreignObject>section{width:1280px;height:720px;box-sizing:border-box;overflow:hidden;position:relative;scroll-snap-align:center center}div#p>svg>foreignObject>section:after{bottom:0;content:attr(data-marpit-pagination);padding:inherit;pointer-events:none;position:absolute;right:0}div#p>svg>foreignObject>section:not([data-marpit-pagination]):after{display:none}/* Normalization */div#p>svg>foreignObject>section h1{font-size:2em;margin:0.67em 0}div#p>svg>foreignObject>section video::-webkit-media-controls{will-change:transform}@page{size:1280px 720px;margin:0}@media print{body,html{background-color:#fff;margin:0;page-break-inside:avoid;break-inside:avoid-page}div#p>svg>foreignObject>section{page-break-before:always;break-before:page}div#p>svg>foreignObject>section,div#p>svg>foreignObject>section *{-webkit-print-color-adjust:exact!important;color-adjust:exact!important}div#p>svg[data-marpit-svg]{display:block;height:100vh;width:100vw}}div#p>svg>foreignObject>section svg[data-marp-fitting=svg]{display:block;height:auto;width:100%}@supports (-ms-ime-align:auto){div#p>svg>foreignObject>section svg[data-marp-fitting=svg]{position:static}}div#p>svg>foreignObject>section svg[data-marp-fitting=svg].__reflow__{content:""}@supports (-ms-ime-align:auto){div#p>svg>foreignObject>section svg[data-marp-fitting=svg].__reflow__{position:relative}}div#p>svg>foreignObject>section [data-marp-fitting-svg-content]{display:table;white-space:nowrap}div#p>svg>foreignObject>section [data-marp-fitting-svg-content-wrap]{white-space:pre}div#p>svg>foreignObject>section img[data-marp-twemoji]{background:transparent;height:1em;margin:0 .05em 0 .1em;vertical-align:-.1em;width:1em}
/*!
 * Marp / Marpit Gaia theme.
 *
 * @theme gaia
 * @author Yuki Hattori
 *
 * @auto-scaling true
 * @size 4:3 960px 720px
 */div#p>svg>foreignObject>section .hljs{display:block;overflow-x:auto;padding:.5em;background:#000;color:#f8f8f8}div#p>svg>foreignObject>section .hljs-comment,div#p>svg>foreignObject>section .hljs-quote{color:#aeaeae;font-style:italic}div#p>svg>foreignObject>section .hljs-keyword,div#p>svg>foreignObject>section .hljs-selector-tag,div#p>svg>foreignObject>section .hljs-type{color:#e28964}div#p>svg>foreignObject>section .hljs-string{color:#65b042}div#p>svg>foreignObject>section .hljs-subst{color:#daefa3}div#p>svg>foreignObject>section .hljs-link,div#p>svg>foreignObject>section .hljs-regexp{color:#e9c062}div#p>svg>foreignObject>section .hljs-name,div#p>svg>foreignObject>section .hljs-section,div#p>svg>foreignObject>section .hljs-tag,div#p>svg>foreignObject>section .hljs-title{color:#89bdff}div#p>svg>foreignObject>section .hljs-class .hljs-title,div#p>svg>foreignObject>section .hljs-doctag{text-decoration:underline}div#p>svg>foreignObject>section .hljs-bullet,div#p>svg>foreignObject>section .hljs-number,div#p>svg>foreignObject>section .hljs-symbol{color:#3387cc}div#p>svg>foreignObject>section .hljs-params,div#p>svg>foreignObject>section .hljs-template-variable,div#p>svg>foreignObject>section .hljs-variable{color:#3e87e3}div#p>svg>foreignObject>section .hljs-attribute{color:#cda869}div#p>svg>foreignObject>section .hljs-meta{color:#8996a8}div#p>svg>foreignObject>section .hljs-formula{background-color:#0e2231;color:#f8f8f8;font-style:italic}div#p>svg>foreignObject>section .hljs-addition{background-color:#253b22;color:#f8f8f8}div#p>svg>foreignObject>section .hljs-deletion{background-color:#420e09;color:#f8f8f8}div#p>svg>foreignObject>section .hljs-selector-class{color:#9b703f}div#p>svg>foreignObject>section .hljs-selector-id{color:#8b98ab}div#p>svg>foreignObject>section .hljs-emphasis{font-style:italic}div#p>svg>foreignObject>section .hljs-strong{font-weight:700}div#p>svg>foreignObject>section svg[data-marp-fitting=svg]{max-height:580px}div#p>svg>foreignObject>section h1,div#p>svg>foreignObject>section h2,div#p>svg>foreignObject>section h3,div#p>svg>foreignObject>section h4,div#p>svg>foreignObject>section h5,div#p>svg>foreignObject>section h6{margin:.5em 0 0}div#p>svg>foreignObject>section h1 strong,div#p>svg>foreignObject>section h2 strong,div#p>svg>foreignObject>section h3 strong,div#p>svg>foreignObject>section h4 strong,div#p>svg>foreignObject>section h5 strong,div#p>svg>foreignObject>section h6 strong{font-weight:inherit}div#p>svg>foreignObject>section h1{font-size:1.8em}div#p>svg>foreignObject>section h2{font-size:1.5em}div#p>svg>foreignObject>section h3{font-size:1.3em}div#p>svg>foreignObject>section h4{font-size:1.1em}div#p>svg>foreignObject>section h5{font-size:1em}div#p>svg>foreignObject>section h6{font-size:.9em}div#p>svg>foreignObject>section blockquote,div#p>svg>foreignObject>section p{margin:1em 0 0}div#p>svg>foreignObject>section ol>li,div#p>svg>foreignObject>section ul>li{margin:.3em 0 0}div#p>svg>foreignObject>section ol>li>p,div#p>svg>foreignObject>section ul>li>p{margin:.6em 0 0}div#p>svg>foreignObject>section code{display:inline-block;font-family:Roboto Mono,monospace;font-size:.8em;letter-spacing:0;margin:-.1em .15em;padding:.1em .2em;vertical-align:baseline}div#p>svg>foreignObject>section pre{display:block;margin:1em 0 0;min-height:1em;overflow:visible}div#p>svg>foreignObject>section pre code{box-sizing:border-box;margin:0;min-width:100%;padding:.5em;font-size:.7em}div#p>svg>foreignObject>section pre code svg[data-marp-fitting=svg]{max-height:calc(580px - 1em)}div#p>svg>foreignObject>section blockquote{margin:1em 0 0;padding:0 1em;position:relative}div#p>svg>foreignObject>section blockquote:after,div#p>svg>foreignObject>section blockquote:before{content:"‚Äú";display:block;font-family:Times New Roman,serif;font-weight:700;position:absolute}div#p>svg>foreignObject>section blockquote:before{top:0;left:0}div#p>svg>foreignObject>section blockquote:after{right:0;bottom:0;-webkit-transform:rotate(180deg);transform:rotate(180deg)}div#p>svg>foreignObject>section blockquote>:first-child{margin-top:0}div#p>svg>foreignObject>section mark{background:transparent}div#p>svg>foreignObject>section table{border-spacing:0;border-collapse:collapse;margin:1em 0 0}div#p>svg>foreignObject>section table td,div#p>svg>foreignObject>section table th{padding:.2em .4em;border-width:1px;border-style:solid}div#p>svg>foreignObject>section{background-image:linear-gradient(135deg,hsla(0,0%,53.3%,0),hsla(0,0%,53.3%,.02) 50%,hsla(0,0%,100%,0) 0,hsla(0,0%,100%,.05));font-size:35px;font-family:Lato,Avenir Next,Avenir,Trebuchet MS,Segoe UI,sans-serif;height:720px;line-height:1.35;letter-spacing:1.25px;padding:70px;width:1280px;word-wrap:break-word;color:#455a64;background-color:#fff8e1}div#p>svg>foreignObject>section>:first-child,div#p>svg>foreignObject>section>header:first-child+*{margin-top:0}div#p>svg>foreignObject>section a,div#p>svg>foreignObject>section mark{color:#0288d1}div#p>svg>foreignObject>section code{background:#6a7a7d;color:#fff8e1}div#p>svg>foreignObject>section h1 strong,div#p>svg>foreignObject>section h2 strong,div#p>svg>foreignObject>section h3 strong,div#p>svg>foreignObject>section h4 strong,div#p>svg>foreignObject>section h5 strong,div#p>svg>foreignObject>section h6 strong{color:#0288d1}div#p>svg>foreignObject>section pre>code{background:#455a64}div#p>svg>foreignObject>section blockquote:after,div#p>svg>foreignObject>section blockquote:before,div#p>svg>foreignObject>section footer,div#p>svg>foreignObject>section header,div#p>svg>foreignObject>section section:after{color:#6a7a7d}div#p>svg>foreignObject>section table td,div#p>svg>foreignObject>section table th{border-color:#455a64}div#p>svg>foreignObject>section table thead th{background:#455a64;color:#fff8e1}div#p>svg>foreignObject>section table tbody>tr:nth-child(odd) td,div#p>svg>foreignObject>section table tbody>tr:nth-child(odd) th{background:rgba(69,90,100,.1)}div#p>svg>foreignObject>section.invert{color:#fff8e1;background-color:#455a64}div#p>svg>foreignObject>section.invert a,div#p>svg>foreignObject>section.invert mark{color:#81d4fa}div#p>svg>foreignObject>section.invert code{background:#dad8c8;color:#455a64}div#p>svg>foreignObject>section.invert h1 strong,div#p>svg>foreignObject>section.invert h2 strong,div#p>svg>foreignObject>section.invert h3 strong,div#p>svg>foreignObject>section.invert h4 strong,div#p>svg>foreignObject>section.invert h5 strong,div#p>svg>foreignObject>section.invert h6 strong{color:#81d4fa}div#p>svg>foreignObject>section.invert pre>code{background:#fff8e1}div#p>svg>foreignObject>section.invert blockquote:after,div#p>svg>foreignObject>section.invert blockquote:before,div#p>svg>foreignObject>section.invert footer,div#p>svg>foreignObject>section.invert header,div#p>svg>foreignObject>section.invert section:after{color:#dad8c8}div#p>svg>foreignObject>section.invert table td,div#p>svg>foreignObject>section.invert table th{border-color:#fff8e1}div#p>svg>foreignObject>section.invert table thead th{background:#fff8e1;color:#455a64}div#p>svg>foreignObject>section.invert table tbody>tr:nth-child(odd) td,div#p>svg>foreignObject>section.invert table tbody>tr:nth-child(odd) th{background:rgba(255,248,225,.1)}div#p>svg>foreignObject>section.gaia{color:#fff8e1;background-color:#0288d1}div#p>svg>foreignObject>section.gaia a,div#p>svg>foreignObject>section.gaia mark{color:#81d4fa}div#p>svg>foreignObject>section.gaia code{background:#cce2de;color:#0288d1}div#p>svg>foreignObject>section.gaia h1 strong,div#p>svg>foreignObject>section.gaia h2 strong,div#p>svg>foreignObject>section.gaia h3 strong,div#p>svg>foreignObject>section.gaia h4 strong,div#p>svg>foreignObject>section.gaia h5 strong,div#p>svg>foreignObject>section.gaia h6 strong{color:#81d4fa}div#p>svg>foreignObject>section.gaia pre>code{background:#fff8e1}div#p>svg>foreignObject>section.gaia blockquote:after,div#p>svg>foreignObject>section.gaia blockquote:before,div#p>svg>foreignObject>section.gaia footer,div#p>svg>foreignObject>section.gaia header,div#p>svg>foreignObject>section.gaia section:after{color:#cce2de}div#p>svg>foreignObject>section.gaia table td,div#p>svg>foreignObject>section.gaia table th{border-color:#fff8e1}div#p>svg>foreignObject>section.gaia table thead th{background:#fff8e1;color:#0288d1}div#p>svg>foreignObject>section.gaia table tbody>tr:nth-child(odd) td,div#p>svg>foreignObject>section.gaia table tbody>tr:nth-child(odd) th{background:rgba(255,248,225,.1)}div#p>svg>foreignObject>section.lead{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;flex-wrap:nowrap;-webkit-box-pack:center;justify-content:center}div#p>svg>foreignObject>section.lead h1,div#p>svg>foreignObject>section.lead h2,div#p>svg>foreignObject>section.lead h3,div#p>svg>foreignObject>section.lead h4,div#p>svg>foreignObject>section.lead h5,div#p>svg>foreignObject>section.lead h6{text-align:center}div#p>svg>foreignObject>section.lead h1 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h2 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h3 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h4 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h5 svg[data-marp-fitting=svg],div#p>svg>foreignObject>section.lead h6 svg[data-marp-fitting=svg]{--preserve-aspect-ratio:xMidYMid meet}div#p>svg>foreignObject>section.lead p{text-align:center}div#p>svg>foreignObject>section.lead blockquote>h1,div#p>svg>foreignObject>section.lead blockquote>h2,div#p>svg>foreignObject>section.lead blockquote>h3,div#p>svg>foreignObject>section.lead blockquote>h4,div#p>svg>foreignObject>section.lead blockquote>h5,div#p>svg>foreignObject>section.lead blockquote>h6,div#p>svg>foreignObject>section.lead blockquote>p{text-align:left}div#p>svg>foreignObject>section.lead blockquote svg[data-marp-fitting=svg]:not([data-marp-fitting-math]){--preserve-aspect-ratio:xMinYMin meet}div#p>svg>foreignObject>section.lead ol>li>p,div#p>svg>foreignObject>section.lead ul>li>p{text-align:left}div#p>svg>foreignObject>section.lead table{margin-left:auto;margin-right:auto}div#p>svg>foreignObject>section:after,div#p>svg>foreignObject>section footer,div#p>svg>foreignObject>section header{box-sizing:border-box;font-size:66%;height:70px;line-height:50px;overflow:hidden;padding:10px 25px;position:absolute}div#p>svg>foreignObject>section header{top:0}div#p>svg>foreignObject>section footer,div#p>svg>foreignObject>section header{left:0;right:0}div#p>svg>foreignObject>section footer{bottom:0}div#p>svg>foreignObject>section:after{right:0;bottom:0;font-size:80%}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]{display:block!important;padding:0!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]:after,div#p>svg>foreignObject>section[data-marpit-advanced-background=background]:before,div#p>svg>foreignObject>section[data-marpit-advanced-background=content]:after,div#p>svg>foreignObject>section[data-marpit-advanced-background=content]:before{display:none!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container]{all:initial;display:flex;flex-direction:row;height:100%;overflow:hidden;width:100%}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container][data-marpit-advanced-background-direction=vertical]{flex-direction:column}div#p>svg>foreignObject>section[data-marpit-advanced-background=background][data-marpit-advanced-background-split]>div[data-marpit-advanced-background-container]{width:var(--marpit-advanced-background-split,50%)}div#p>svg>foreignObject>section[data-marpit-advanced-background=background][data-marpit-advanced-background-split=right]>div[data-marpit-advanced-background-container]{margin-left:calc(100% - var(--marpit-advanced-background-split, 50%))}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container]>figure{all:initial;background-position:center;background-repeat:no-repeat;background-size:cover;flex:auto;margin:0}div#p>svg>foreignObject>section[data-marpit-advanced-background=content],div#p>svg>foreignObject>section[data-marpit-advanced-background=pseudo]{background:transparent!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=pseudo],div#p>svg[data-marpit-svg]>foreignObject[data-marpit-advanced-background=pseudo]{pointer-events:none!important}div#p>svg>foreignObject>section[data-marpit-advanced-background-split]{width:100%;height:100%}</style></head><body><div class="bespoke-marp-osc"><button data-bespoke-marp-osc="prev" tabindex="-1" title="Previous slide">Previous slide</button><span data-bespoke-marp-osc="page"></span><button data-bespoke-marp-osc="next" tabindex="-1" title="Next slide">Next slide</button><button data-bespoke-marp-osc="fullscreen" tabindex="-1" title="Toggle fullscreen (f)">Toggle fullscreen</button><button data-bespoke-marp-osc="presenter" tabindex="-1" title="Open presenter view (p)">Open presenter view</button></div><div id="p"><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="1" data-class="lead invert" data-header="@bogardguillaume - guillaumebogard.dev" data-theme="gaia" class="lead invert" style="--class:lead invert;--header:@bogardguillaume - guillaumebogard.dev;--theme:gaia;">
<header>@bogardguillaume - guillaumebogard.dev</header>

<p><img src="./img/cats-logo.png" alt="" /></p>
<h1>IO monad &amp; Error management</h1>
<h2>From exceptions to Cats MTL</h2>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="2" data-theme="gaia" style="--theme:gaia;">
<h1>Bonjour !</h1>
<p>My name is <strong>Guillaume Bogard</strong>. I'm a Scala Developer @Linkvalue.</p>
<p>I love functional programming, roller-coasters, and Age of Empires.</p>
<p>...</p>
<p>Also mechanical keyboards ‚å®</p>
<p>You can follow me on Twitter @bogardguillaume and on <a href="">guillaumebogard.dev</a></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="3" data-class="lead" data-theme="gaia" class="lead" style="--class:lead;--theme:gaia;">
<h1>Let's talk about IO</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="4" data-theme="gaia" style="--theme:gaia;">
<h1>The <em>M Word</em>, a quick recap</h1>
<p><strong>A Monad <code>M[T]</code> is an immutable data structure used to describe the computation of one or more values of type <code>A</code></strong></p>
<ul>
<li>Values of type <code>T</code> can be turned into <em>monadic values</em> <code>M[T]</code></li>
<li>Monads can chain subsequent computations (i.e solve big problems out of smaller problems)</li>
<li>They describe some <em>functional effect</em>: <code>Option</code> describes optionality, <code>Either</code> describes failure, <code>List</code> describes<br />
non-determinism</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="5" data-theme="gaia" style="--theme:gaia;">
<h1>Why do we need IO anyway ?</h1>

<ul>
<li>
<p><code>IO</code>s are <strong>programs as values</strong>.</p>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getUser</span></span>(id: <span class="hljs-type">String</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">User</span>]
</span></span></foreignObject></svg></code></pre>
</li>
<li>
<p>They turn impure programs into referentially transparent values.</p>
</li>
<li>
<p>They reveal the presence of sneaky side effects <img class="emoji" draggable="false" alt="üêç" src="https://twemoji.maxcdn.com/2/svg/1f40d.svg" data-marp-twemoji=""/></p>
</li>
<li>
<p>They <strong>compose</strong> :</p>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getFavoritePet</span></span>(user: <span class="hljs-type">User</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">Pet</span>]
<span class="hljs-keyword">val</span> marksFavoritePet: <span class="hljs-type">IO</span>[<span class="hljs-type">Pet</span>] = getUser(<span class="hljs-string">"Mark"</span>) flatMap getFavoritePet
</span></span></foreignObject></svg></code></pre>
</li>
</ul>
<h2></h2>
<h2>Use case : a functional web service</h2>
<p><em>Routes</em> are merely <strong>functions from <code>Request</code> to <code>IO[Response]</code></strong>.</p>
<p>Let's say we want to retrieve a pet by its owner id, I can compose my IOs just like any monad.</p>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getPetByOwnerId</span></span>(request: <span class="hljs-type">Request</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">Pet</span>] = {
  user &lt;- getUser(request.id)

}
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="6" data-theme="gaia" style="--theme:gaia;">
<h1>When things go wrong</h1>
<p>Cats effect allows to raise <code>Throwable</code>s inside the <code>IO</code> context, propagate them across all the <code>IO</code> chain, and recover them later.</p>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-keyword">val</span> failedIO: <span class="hljs-type">IO</span>[<span class="hljs-type">Int</span>] = <span class="hljs-type">IO</span>.raiseError(<span class="hljs-keyword">new</span> <span class="hljs-type">Exception</span>(<span class="hljs-string">"Boom"</span>))

failedIO.recoverWith({
  <span class="hljs-keyword">case</span> e =&gt; <span class="hljs-type">IO</span> {
    logger.error(<span class="hljs-string">"Something went wrong"</span>, e)
    <span class="hljs-number">42</span>
  }
}).unsafeRunSync() <span class="hljs-comment">// =&gt; 42</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="7" data-theme="gaia" style="--theme:gaia;">
<h2>Use case : Modeling an authentication flow</h2>
<p>I want to authenticate a user using a name and a password. I need to return the user's information.</p>
<ul>
<li>I need to find the user information (maybe from a database)</li>
<li>Check that the password is valid by comparing hashes</li>
<li>I need to check that the user subscription is valid (maybe through a billing service)</li>
<li>And the user must not be banned from our service</li>
</ul>
<p>I could do all that by composing several <code>IO</code> together.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="8" data-theme="gaia" style="--theme:gaia;">
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">WrongUserName</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span>(<span class="hljs-params">"<span class="hljs-type">No</span> user with that name"</span>)</span>
<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">WrongPassword</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span>(<span class="hljs-params">"<span class="hljs-type">Wrong</span> password"</span>)</span>
<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExpiredSubscription</span>(<span class="hljs-params">expirationDate: <span class="hljs-type">Date</span></span>) <span class="hljs-keyword">extends</span></span>
  <span class="hljs-type">RuntimeException</span>(<span class="hljs-string">"Expired subscription"</span>)
<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">BannedUser</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span>(<span class="hljs-params">"<span class="hljs-type">User</span> is banned"</span>)</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">findUserByName</span></span>(username: <span class="hljs-type">String</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">User</span>] = ???
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkPassword</span></span>(user: <span class="hljs-type">User</span>, password: <span class="hljs-type">String</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">Unit</span>] = ???
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkSubscription</span></span>(user: <span class="hljs-type">User</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">Unit</span>] = ???
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkUserStatus</span></span>(user: <span class="hljs-type">User</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">Unit</span>] = ???

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">authenticate</span></span>(userName: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">User</span>] =
  <span class="hljs-keyword">for</span> {
    user &lt;- findUserByName(userName)
    _ &lt;- checkPassword(user, password)
    _ &lt;- checkSubscription(user)
    _ &lt;- checkUserStatus(user)
  } <span class="hljs-keyword">yield</span> user
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="9" data-theme="gaia" style="--theme:gaia;">
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>authenticate(<span class="hljs-string">"john.doe"</span>, <span class="hljs-string">"foo.bar"</span>)
  .flatMap(user =&gt; <span class="hljs-type">IO</span> {
    println(<span class="hljs-string">s"Success! <span class="hljs-subst">$user</span>"</span>)
  })
  .recoverWith({
    <span class="hljs-keyword">case</span> <span class="hljs-type">WrongUserName</span> =&gt; <span class="hljs-type">IO</span> { <span class="hljs-comment">/* Do stuff ... */</span> }
    <span class="hljs-keyword">case</span> <span class="hljs-type">WrongPassword</span> =&gt; <span class="hljs-type">IO</span> { <span class="hljs-comment">/* Do stuff ... */</span> }
    <span class="hljs-keyword">case</span> <span class="hljs-type">ExpiredSubscription</span>(date) =&gt; <span class="hljs-type">IO</span> { <span class="hljs-comment">/* Do stuff ... */</span> }
    <span class="hljs-keyword">case</span> <span class="hljs-type">BannedUser</span> =&gt; <span class="hljs-type">IO</span> { <span class="hljs-comment">/* Do stuff ... */</span> }
    <span class="hljs-keyword">case</span> _ =&gt; <span class="hljs-type">IO</span> {
      println(<span class="hljs-string">"Another exception was caught !"</span>)
    }
  })
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="10" data-theme="gaia" style="--theme:gaia;">
<h1>The issues with Exception</h1>
<ul>
<li><img class="emoji" draggable="false" alt="‚ùå" src="https://twemoji.maxcdn.com/2/svg/274c.svg" data-marp-twemoji=""/> Exceptions are invisible</li>
<li><img class="emoji" draggable="false" alt="‚ùå" src="https://twemoji.maxcdn.com/2/svg/274c.svg" data-marp-twemoji=""/> They must be explicitly recovered</li>
<li><img class="emoji" draggable="false" alt="‚ùå" src="https://twemoji.maxcdn.com/2/svg/274c.svg" data-marp-twemoji=""/> They must be explicitly documented </li>
<li><img class="emoji" draggable="false" alt="‚ùå" src="https://twemoji.maxcdn.com/2/svg/274c.svg" data-marp-twemoji=""/> They can be ambiguous :
<ul>
<li><code>IO</code>s only raise and recover <code>Throwable</code>s. Type-wise they don't distinguish between <code>java.util.concurrent.TimeoutException</code> &amp; <code>AuthenticationException</code>.</li>
</ul>
</li>
<li><img class="emoji" draggable="false" alt="‚ùå" src="https://twemoji.maxcdn.com/2/svg/274c.svg" data-marp-twemoji=""/> You get no proper exhaustivity check</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="11" data-theme="gaia" style="--theme:gaia;">
<h1>This is a lie</h1>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">authenticate</span></span>(userName: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">User</span>]
</span></span></foreignObject></svg></code></pre>
<p>The method's signature doesn't convey anything about possible error cases.</p>
<p>Unhandled errors will be propagated across the whole application once the IO is ran like good ol' Java when you forget to <code>try/catch</code>.</p>
<p>Requires more reading and more testing.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="12" data-class="lead invert" data-theme="gaia" class="lead invert" style="--class:lead invert;--theme:gaia;">
<h1>Make exceptions exceptional again</h1>
<h4><img class="emoji" draggable="false" alt="‚ö†Ô∏è" src="https://twemoji.maxcdn.com/2/svg/26a0.svg" data-marp-twemoji=""/> Opinionated statements incoming</h4>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="13" data-theme="gaia" style="--theme:gaia;">
<h2>Domain errors are not exceptions</h2>
<ul>
<li>
<p>Domain errors are documented edge cases that can happen as part of the user experience.<br />
e.g.: The user hasn't paid their subscription</p>
</li>
<li>
<p>Exceptions should be reserved for unexpected, purely technical failures.<br />
e.g.: The database server is unreachable.</p>
</li>
</ul>
<p>Exceptions should be propagated to the upper levels of the app and actively monitored.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="14" data-theme="gaia" style="--theme:gaia;">
<h1>Modeling errors using an ADT</h1>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-keyword">sealed</span> <span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">AuthenticationError</span></span>
<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">WrongUserName</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthenticationError</span></span>
<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">WrongPassword</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthenticationError</span></span>
<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExpiredSubscription</span>(<span class="hljs-params">expirationDate: <span class="hljs-type">Date</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthenticationError</span></span>
<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">BannedUser</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthenticationError</span></span>
</span></span></foreignObject></svg></code></pre>
<h2>Using it with <code>Either</code></h2>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">authenticate</span></span>(userName: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">Either</span>[<span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">User</span>]]
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="15" data-theme="gaia" style="--theme:gaia;">
<h1>What we've achieved</h1>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">authenticate</span></span>(userName: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">Either</span>[<span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">User</span>]]
</span></span></foreignObject></svg></code></pre>
<ul>
<li><img class="emoji" draggable="false" alt="‚úÖ" src="https://twemoji.maxcdn.com/2/svg/2705.svg" data-marp-twemoji=""/> Side effects are obvious</li>
<li><img class="emoji" draggable="false" alt="‚úÖ" src="https://twemoji.maxcdn.com/2/svg/2705.svg" data-marp-twemoji=""/> Domain errors are visible and cannot be forgotten</li>
<li><img class="emoji" draggable="false" alt="‚úÖ" src="https://twemoji.maxcdn.com/2/svg/2705.svg" data-marp-twemoji=""/> Technical errors can still be raised and recovered</li>
<li><img class="emoji" draggable="false" alt="‚úÖ" src="https://twemoji.maxcdn.com/2/svg/2705.svg" data-marp-twemoji=""/> No need to check the documentation for unhandled edge cases</li>
<li><img class="emoji" draggable="false" alt="‚úÖ" src="https://twemoji.maxcdn.com/2/svg/2705.svg" data-marp-twemoji=""/> We have clearly distinct error families</li>
</ul>
<p><strong>But</strong> we've lost something very important along the way</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="16" data-theme="gaia" style="--theme:gaia;">
<h2>This does not compose anymore !</h2>
<p><img class="emoji" draggable="false" alt="‚ùå" src="https://twemoji.maxcdn.com/2/svg/274c.svg" data-marp-twemoji=""/> This does not compile</p>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">findUserByName</span></span>(username: <span class="hljs-type">String</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">Either</span>[<span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">User</span>]] = ???
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkPassword</span></span>(user: <span class="hljs-type">User</span>, password: <span class="hljs-type">String</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">Either</span>[<span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">Unit</span>]] = ???
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkSubscription</span></span>(user: <span class="hljs-type">User</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">Either</span>[<span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">Unit</span>]] = ???
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkUserStatus</span></span>(user: <span class="hljs-type">User</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">Either</span>[<span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">Unit</span>]] = ???

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">authenticate</span></span>(userName: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">Either</span>[<span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">User</span>]] =
  <span class="hljs-keyword">for</span> {
    user &lt;- findUserByName(userName)
    _ &lt;- checkPassword(user, password)
    _ &lt;- checkSubscription(user)
    _ &lt;- checkUserStatus(user)
  } <span class="hljs-keyword">yield</span> user
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="17" data-theme="gaia" style="--theme:gaia;">
<p>We can't compose many <code>IO[Either[A, B]]</code> together. We must handle the errors explicitly.</p>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">authenticate</span></span>(userName: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">Either</span>[<span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">User</span>]] =
  findUserByName(userName).flatMap({
    <span class="hljs-keyword">case</span> <span class="hljs-type">Right</span>(user) =&gt; checkPassword(user, password).flatMap({
      <span class="hljs-keyword">case</span> <span class="hljs-type">Right</span>(_) =&gt; checkSubscription(user).flatMap({
        <span class="hljs-keyword">case</span> <span class="hljs-type">Right</span>(_) =&gt; checkUserStatus(user).map(_.map(_ =&gt; user))
        <span class="hljs-keyword">case</span> <span class="hljs-type">Left</span>(err) =&gt; <span class="hljs-type">IO</span>.pure(<span class="hljs-type">Left</span>(err))
      })
      <span class="hljs-keyword">case</span> <span class="hljs-type">Left</span>(err) =&gt; <span class="hljs-type">IO</span>.pure(<span class="hljs-type">Left</span>(err))
    })
    <span class="hljs-keyword">case</span> <span class="hljs-type">Left</span>(err) =&gt; <span class="hljs-type">IO</span>.pure(<span class="hljs-type">Left</span>(err))
  })
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-class="lead invert" data-theme="gaia" class="lead invert" style="--class:lead invert;--theme:gaia;" data-marpit-advanced-background="background"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;img/transformers.jpg&quot;);filter:opacity(.5);"></figure></div></section></foreignObject><foreignObject width="1280" height="720"><section id="18" data-class="lead invert" data-theme="gaia" class="lead invert" style="--class:lead invert;--theme:gaia;" data-marpit-advanced-background="content">
<h1>Monad Transformers</h1>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section class="lead invert" style="" data-marpit-advanced-background="pseudo"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="19" data-class="lead invert" data-theme="gaia" class="lead invert" style="--class:lead invert;--theme:gaia;">
<p>Monad transformers (<code>OptionT</code>, <code>IorT</code>, <code>EitherT</code>, <code>ReaderT</code> and <code>WriterT</code>) add new behavior, also referred to as as <em>effect</em>, to an underlying monad while preserving compositionality.</p>
<p>E.g : <code>OptionT[F, A]</code> creates a new monad which adds the effect of absence to a monad F.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="20" data-theme="gaia" style="--theme:gaia;">
<h2>From <code>F[Either[A, B]</code> to <code>EitherT[F, A, B]</code></h2>
<blockquote>
<p><code>EitherT[F, L, R]</code> is a light wrapper around <code>F[Either[A, B]]</code> that makes it easy to compose <code>Either</code>s and <code>F</code>s together.</p>
</blockquote>
<ul>
<li>It has bidirectional transformation from/to <code>F[Either[A, B]]</code> via the <code>apply</code> and <code>value</code> methods respectively.</li>
</ul>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-keyword">val</span> a: <span class="hljs-type">IO</span>[<span class="hljs-type">Either</span>[<span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">User</span>]] = ???
<span class="hljs-keyword">val</span> b: <span class="hljs-type">EitherT</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">User</span>] = <span class="hljs-type">EitherT</span>(a)
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="21" data-theme="gaia" style="--theme:gaia;">
<p><code>EitherT</code> forms a compound monad out of two out of some <code>F</code> type, and the <code>Either</code> monad.</p>
<p>When <code>F</code> is a monad, such as <code>IO</code>, <code>EitherT</code> will also form a monad, making it easy to compose the compound monad using <code>map</code> and <code>flatMap</code>.</p>
<p><code>OptionT</code> does the same for <code>Option</code>.</p>
<p><code>IorT</code> does the same for <code>Ior</code> (an inclusive-or relationship between two data types)</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="22" data-theme="gaia" style="--theme:gaia;">
<h2>Rewriting our authentication method</h2>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">findUserByName</span></span>(username: <span class="hljs-type">String</span>): <span class="hljs-type">EitherT</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">User</span>] = ???
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkPassword</span></span>(user: <span class="hljs-type">User</span>, password: <span class="hljs-type">String</span>): <span class="hljs-type">EitherT</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">Unit</span>] = ???
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkSubscription</span></span>(user: <span class="hljs-type">User</span>): <span class="hljs-type">EitherT</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">Unit</span>] = ???
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkUserStatus</span></span>(user: <span class="hljs-type">User</span>): <span class="hljs-type">EitherT</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">Unit</span>] = ???

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">authenticate</span></span>(userName: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>): <span class="hljs-type">EitherT</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">User</span>] =
  <span class="hljs-keyword">for</span> {
    user &lt;- findUserByName(userName)
    _ &lt;- checkPassword(user, password)
    _ &lt;- checkSubscription(user)
    _ &lt;- checkUserStatus(user)
  } <span class="hljs-keyword">yield</span> user
</span></span></foreignObject></svg></code></pre>
<p><code>EitherT</code> will short-circuit computation on the first encountered error, a pattern sometimes called <em>Railway-oriented programming</em> <img class="emoji" draggable="false" alt="üöÇ" src="https://twemoji.maxcdn.com/2/svg/1f682.svg" data-marp-twemoji=""/></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="23" data-theme="gaia" style="--theme:gaia;">
<h2>Look how far we've come!</h2>
<p>We've met all our gaols :</p>
<ul>
<li><img class="emoji" draggable="false" alt="‚úÖ" src="https://twemoji.maxcdn.com/2/svg/2705.svg" data-marp-twemoji=""/> Side effects visible</li>
<li><img class="emoji" draggable="false" alt="‚úÖ" src="https://twemoji.maxcdn.com/2/svg/2705.svg" data-marp-twemoji=""/> <code>IO</code>s and errors can be composed, railway style</li>
<li><img class="emoji" draggable="false" alt="‚úÖ" src="https://twemoji.maxcdn.com/2/svg/2705.svg" data-marp-twemoji=""/> We still get the benefit of having two distinct error channels :
<ul>
<li>Exceptions thrown inside the IO for purely technical failures</li>
<li>The <em>Left</em> of the <code>Either</code> for business-related errors</li>
</ul>
</li>
</ul>
<p>This way we can <strong>fail fast</strong> on technical failures and easily provide good feedback to the user for business edge cases.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="24" data-class="lead invert" data-theme="gaia" class="lead invert" style="--class:lead invert;--theme:gaia;">
<h1>We've won, let's have a drink! <img class="emoji" draggable="false" alt="üçª" src="https://twemoji.maxcdn.com/2/svg/1f37b.svg" data-marp-twemoji=""/></h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="25" data-class="lead" data-theme="gaia" class="lead" style="--class:lead;--theme:gaia;">
<h1>But, wait, what about Cats MTL then ?</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="26" data-theme="gaia" style="--theme:gaia;">
<h1>Challenges yet to address</h1>
<ul>
<li>What about nested transformers ? What if I want to model mutable state <strong>and</strong> potential absence for example ?</li>
<li>What about type inference and expressivity ?
<ul>
<li>Nesting monad transformers requires many type parameters and type lambdas. The more you nest, the worst inference gets!</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="27" data-class="lead" data-theme="gaia" class="lead" style="--class:lead;--theme:gaia;">
<h2>Can you guess what this code does ?</h2>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>  <span class="hljs-comment">// Retrieves document from a super secure data store</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getDocument</span></span>: <span class="hljs-type">IO</span>[<span class="hljs-type">SecretDocument</span>] = ???

  <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Count</span> </span>= <span class="hljs-type">Int</span>
<span class="hljs-keyword">val</span> readSecretDocument: <span class="hljs-type">User</span> =&gt; <span class="hljs-type">EitherT</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">String</span>, <span class="hljs-type">SecretDocument</span>] = {
    <span class="hljs-keyword">val</span> state: <span class="hljs-type">StateT</span>[<span class="hljs-type">ReaderT</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">User</span>, *], <span class="hljs-type">Count</span>, <span class="hljs-type">Either</span>[<span class="hljs-type">String</span>, <span class="hljs-type">SecretDocument</span>]] =
      <span class="hljs-type">StateT</span>[<span class="hljs-type">ReaderT</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">User</span>, *], <span class="hljs-type">Int</span>, <span class="hljs-type">Either</span>[<span class="hljs-type">String</span>, <span class="hljs-type">SecretDocument</span>]](currentAttemptsCount =&gt;
        <span class="hljs-type">ReaderT</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">User</span>, (<span class="hljs-type">Count</span>, <span class="hljs-type">Either</span>[<span class="hljs-type">String</span>, <span class="hljs-type">SecretDocument</span>])](user =&gt;
          <span class="hljs-keyword">if</span> (currentAttemptsCount &gt;= <span class="hljs-number">3</span>) <span class="hljs-type">IO</span>.pure((currentAttemptsCount, <span class="hljs-type">Left</span>(<span class="hljs-string">"Max attemps exceeded"</span>)))
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (user.isAdmin) getDocument.map(doc =&gt; (currentAttemptsCount, <span class="hljs-type">Right</span>(doc)))
          <span class="hljs-keyword">else</span> <span class="hljs-type">IO</span>.pure((currentAttemptsCount + <span class="hljs-number">1</span>, <span class="hljs-type">Left</span>(<span class="hljs-string">"Access denied"</span>)))
        )
      )

    state.run(<span class="hljs-number">0</span>).map(_._2).mapF(<span class="hljs-type">EitherT</span>(_)).run
  }
</span></span></foreignObject></svg></code></pre>
<p><strong>Me neither.</strong></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="28" data-class="lead" data-theme="gaia" class="lead" style="--class:lead;--theme:gaia;">
<p>When we need to combine effects (e.g short-circuiting AND mutable state), monad transformers only get us so far.</p>
<p>Scala's inference system can't keep up with nested monad transformers stack, requiring a ridiculous amount of boilerplate to get simple things done.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="29" data-theme="gaia" style="--theme:gaia;">
<h2>The idea of Cats MTL</h2>
<p>Monad transformers encode some <em>effect</em>, e.g. :</p>
<ul>
<li><code>EitherT</code> encodes the effect of short-circuiting on error</li>
<li><code>ReaderT</code> (i.e. <code>Kleisli</code>) encode the effect of accessing a read-only value from a context, and producing a value from it</li>
</ul>

<p>Cats MTL encodes these effects, among others, in <strong>type classes</strong>. It gives the ability to combine effects together, without the drawback of bad inference.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="30" data-theme="gaia" style="--theme:gaia;">
<h3>How would one encode the effect of raising errors ?</h3>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">readSecretDocument</span></span>[<span class="hljs-type">F</span>[_] : <span class="hljs-type">Applicative</span>](user: <span class="hljs-type">User</span>)
  (<span class="hljs-keyword">implicit</span> <span class="hljs-type">F</span>: <span class="hljs-type">FunctorRaise</span>[<span class="hljs-type">F</span>, <span class="hljs-type">String</span>]): <span class="hljs-type">F</span>[<span class="hljs-type">SecretDocument</span>] =
  <span class="hljs-keyword">if</span> (user.isAdmin) <span class="hljs-type">SecretDocument</span>().pure[<span class="hljs-type">F</span>]
  <span class="hljs-keyword">else</span> <span class="hljs-type">F</span>.raise(<span class="hljs-string">"Access Denied!"</span>)
</span></span></foreignObject></svg></code></pre>
<p>We've turned our <code>EitherT</code> into a generic <code>F[_]</code> Applicative. All we know about this <code>F[_]</code> is that there is an instance of <code>FunctorRaise</code> defined for it.</p>
<p>We'll need to provide a concrete implementation of <code>F</code> to run the program.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="31" data-theme="gaia" style="--theme:gaia;">
<h2>What about recovering ?</h2>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getDocumentContent</span></span>[<span class="hljs-type">F</span>[_] : <span class="hljs-type">Applicative</span>](user: <span class="hljs-type">User</span>)
  (<span class="hljs-keyword">implicit</span> <span class="hljs-type">A</span>: <span class="hljs-type">ApplicativeHandle</span>[<span class="hljs-type">F</span>, <span class="hljs-type">String</span>]): <span class="hljs-type">F</span>[<span class="hljs-type">String</span>] =
  readSecretDocument[<span class="hljs-type">F</span>](user)
    .map(_.content)
    .handle[<span class="hljs-type">String</span>](_ =&gt; <span class="hljs-string">"Default content"</span>)
</span></span></foreignObject></svg></code></pre>
<p><code>ApplicativeHandle</code> extends <code>FunctorRaise</code> with the ability to handle errors.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="32" data-theme="gaia" style="--theme:gaia;">
<h2>We still get a dedicate channel for technical failures</h2>
<p>By adding a context bound on <code>MonadError</code>, we can raise <code>Exception</code>s in our IOs, and segregate technical failures from domain errors <img class="emoji" draggable="false" alt="üôå" src="https://twemoji.maxcdn.com/2/svg/1f64c.svg" data-marp-twemoji=""/></p>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">findUserByName</span></span>[<span class="hljs-type">F</span>[_]](name: <span class="hljs-type">String</span>)
  (<span class="hljs-keyword">implicit</span> <span class="hljs-type">AE</span>: <span class="hljs-type">ApplicativeError</span>[<span class="hljs-type">F</span>, <span class="hljs-type">Throwable</span>]) = {
  <span class="hljs-type">AE</span>.raiseError(<span class="hljs-keyword">new</span> <span class="hljs-type">RuntimeException</span>(<span class="hljs-string">"Database not reachable!"</span>))
}
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="33" data-theme="gaia" style="--theme:gaia;">
<h2>Implementing the <code>authenticate</code> method</h2>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkPassword</span></span>[<span class="hljs-type">F</span>[_]](user: <span class="hljs-type">User</span>, password: <span class="hljs-type">String</span>)
  (<span class="hljs-keyword">implicit</span> <span class="hljs-type">F</span>: <span class="hljs-type">FunctorRaise</span>[<span class="hljs-type">F</span>, <span class="hljs-type">AuthenticationError</span>]): <span class="hljs-type">F</span>[<span class="hljs-type">Unit</span>] =
  <span class="hljs-type">F</span>.raise(<span class="hljs-type">WrongPassword</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkSubscription</span></span>[<span class="hljs-type">F</span>[_]](user: <span class="hljs-type">User</span>): <span class="hljs-type">F</span>[<span class="hljs-type">User</span>] = ???
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkUserStatus</span></span>[<span class="hljs-type">F</span>[_]](user: <span class="hljs-type">User</span>): <span class="hljs-type">F</span>[<span class="hljs-type">User</span>] = ???

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">authenticate</span></span>[<span class="hljs-type">F</span>[_]](userName: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>)
  (<span class="hljs-keyword">implicit</span> <span class="hljs-type">F</span>: <span class="hljs-type">FunctorRaise</span>[<span class="hljs-type">F</span>, <span class="hljs-type">AuthenticationError</span>], <span class="hljs-type">AE</span>: <span class="hljs-type">MonadError</span>[<span class="hljs-type">F</span>, <span class="hljs-type">Throwable</span>]): <span class="hljs-type">F</span>[<span class="hljs-type">User</span>] =
  <span class="hljs-keyword">for</span> {
    user &lt;- findUserByName[<span class="hljs-type">F</span>](userName)
    _ &lt;- checkPassword[<span class="hljs-type">F</span>](user, password)
    _ &lt;- checkSubscription[<span class="hljs-type">F</span>](user)
    _ &lt;- checkUserStatus[<span class="hljs-type">F</span>](user)
  } <span class="hljs-keyword">yield</span> user
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="34" data-theme="gaia" style="--theme:gaia;">
<h2>Interpreting the program <img class="emoji" draggable="false" alt="üöÄ" src="https://twemoji.maxcdn.com/2/svg/1f680.svg" data-marp-twemoji=""/></h2>
<p>It's time to provide a concrete implementation for the type classes we used.</p>
<pre><code class="language-scala"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Main</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">App</span> </span>{
  <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">F</span>[<span class="hljs-type">A</span>] </span>= <span class="hljs-type">EitherT</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">AuthenticationError</span>, <span class="hljs-type">A</span>]
  authenticate[<span class="hljs-type">F</span>](<span class="hljs-string">"john.doe"</span>, <span class="hljs-string">"123456"</span>)
}
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="35" data-theme="gaia" style="--theme:gaia;">
<h1>Summing up</h1>
<ul>
<li>Shit happens, we need to handle it carefully</li>
<li>Don't let technical details mess up your domain
<ul>
<li>Monad transformers let you add effects to existing monads, to create more badass monads</li>
<li>Cats MTL gives you this without the syntax headache</li>
</ul>
</li>
<li>Challenge your approach, there are plenty of error management strategies out there! (e.g. ZIO)<br />
Cats MTL is cool, but you might not need it!</li>
<li>Have fun</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="36" data-class="lead invert" data-header="@bogardguillaume - [guillaumebogard.dev]()" data-theme="gaia" class="lead invert" style="--class:lead invert;--header:@bogardguillaume - [guillaumebogard.dev]();--theme:gaia;">
<header>@bogardguillaume - <a href="">guillaumebogard.dev</a></header>

<h1>Thank you!</h1>
<h2>Keep calm and curry on <img class="emoji" draggable="false" alt="üé∏" src="https://twemoji.maxcdn.com/2/svg/1f3b8.svg" data-marp-twemoji=""/></h2>
<p>This talk is on Github :</p>
<h3>gbogard/cats-mtl-talk</h3>
</section>
<script>!function(){"use strict";function t(t){Array.from(document.getElementsByTagName("svg"),e=>{if(e.hasAttribute("data-marpit-svg")){const{clientHeight:r,clientWidth:a}=e;e.style.transform||(e.style.transform="translateZ(0)");const o=t||e.currentScale||1,i=e.viewBox.baseVal.width/o,n=e.viewBox.baseVal.height/o,s=Math.min(r/n,a/i);Array.from(e.querySelectorAll(":scope > foreignObject"),t=>{const e=t.x.baseVal.value,o=t.y.baseVal.value;Array.from(t.querySelectorAll(":scope > section"),t=>{t.style.transformOrigin||(t.style.transformOrigin="0 0");const l=(a-s*i)/2-e,c=(r-s*n)/2-o;t.style.transform=`translate3d(${l}px,${c}px,0) scale(${s}) translate(${e}px,${o}px)`})})}})}const e=(t,e,r)=>{if(t.getAttribute(e)!==r)return t.setAttribute(e,r),!0};function r(a=!0){for(const e of"Apple Computer, Inc."===navigator.vendor?[t]:[])e();Array.from(document.querySelectorAll('svg[data-marp-fitting="svg"]'),t=>{const r=t.firstChild,a=r.firstChild,{scrollWidth:o,scrollHeight:i}=a;let n,s=1;if(t.hasAttribute("data-marp-fitting-code")&&(n=t.parentElement.parentElement),t.hasAttribute("data-marp-fitting-math")&&(n=t.parentElement),n){const t=getComputedStyle(n),e=Math.ceil(n.clientWidth-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight));e&&(s=e)}const l=Math.max(o,s),c=Math.max(i,1),p=`0 0 ${l} ${c}`;e(r,"width",`${l}`),e(r,"height",`${c}`),e(t,"preserveAspectRatio",getComputedStyle(t).getPropertyValue("--preserve-aspect-ratio")||"xMinYMin meet"),e(t,"viewBox",p)&&t.classList.toggle("__reflow__")}),a&&window.requestAnimationFrame(()=>r(a))}!function(){if("undefined"==typeof window)throw new Error("Marp Core's browser script is valid only in browser context.");window.marpCoreBrowserScript?console.warn("Marp Core's browser script has already executed."):(Object.defineProperty(window,"marpCoreBrowserScript",{value:!0}),r())}()}();
</script></foreignObject></svg></div><div class="bespoke-marp-note" data-index="4" tabindex="0"><p>Referentially transparent values mean we can define then in any order, pass them
around, compose them, without any fear of unwanted execution

Encode as much as possible in types.
Make side effects obvious.
Signatures as contracts</p></div><div class="bespoke-marp-note" data-index="5" tabindex="0"><p>Thanks to the MonadError type class 

Thrown exceptions using regular `throw` don't escape the IO context.</p></div><div class="bespoke-marp-note" data-index="9" tabindex="0"><p>They are very easy to forget</p><p></p></div><div class="bespoke-marp-note" data-index="10" tabindex="0"><p>Exceptions don't appear in the signature, yet can have dramatic impact on the program.
Need to check for @throws in the scaladoc part, or even wose : read the implementation 
Should not have to do that since functions signatures are contracts</p></div><div class="bespoke-marp-note" data-index="12" tabindex="0"><p>Because when we fail, we want to fail fast!</p></div><div class="bespoke-marp-note" data-index="14" tabindex="0"><p>They are very easy to forget</p></div><div class="bespoke-marp-note" data-index="15" tabindex="0"><p>Of course, checkPassword and checkSubscription and checkStatus could be executed in parallel</p></div><div class="bespoke-marp-note" data-index="28" tabindex="0"><p>Monad transformers can be used together to add many effects to the same monad</p></div><div class="bespoke-marp-note" data-index="29" tabindex="0"><p>Few things to note here : 
  - The F[_]: Applicative is context bound
  - Functor raise wants you to provide the type of your errors, meaning you can raise any type
  of errors you want, hence our ADT
  - You can add as many effects as you want to the F monad, just add the implicit parameter for the mtl type class you want to implement</p></div><script>!function(){"use strict";var e=function(e,t){var n,r=1===(e.parent||e).nodeType?e.parent||e:document.querySelector(e.parent||e),s=[].filter.call("string"==typeof e.slides?r.querySelectorAll(e.slides):e.slides||r.children,(function(e){return"SCRIPT"!==e.nodeName})),o={},a=function(e,t){return(t=t||{}).index=s.indexOf(e),t.slide=e,t},i=function(e,t){o[e]=(o[e]||[]).filter((function(e){return e!==t}))},l=function(e,t){return(o[e]||[]).reduce((function(e,n){return e&&!1!==n(t)}),!0)},c=function(e,t){s[e]&&(n&&l("deactivate",a(n,t)),n=s[e],l("activate",a(n,t)))},d=function(e,t){var r=s.indexOf(n)+e;l(e>0?"next":"prev",a(n,t))&&c(r,t)},u={off:i,on:function(e,t){return(o[e]||(o[e]=[])).push(t),i.bind(null,e,t)},fire:l,slide:function(e,t){if(!arguments.length)return s.indexOf(n);l("slide",a(s[e],t))&&c(e,t)},next:d.bind(null,1),prev:d.bind(null,-1),parent:r,slides:s,destroy:function(e){l("destroy",a(n,e)),o={}}};return(t||[]).forEach((function(e){e(u)})),n||c(0),u};function t(e){e.parent.classList.add("bespoke-marp-parent"),e.slides.map(e=>e.classList.add("bespoke-marp-slide")),e.on("activate",t=>{e.slides.map(e=>e.classList.remove("bespoke-marp-active")),t.slide.classList.add("bespoke-marp-active")})}function n(e=2e3){return t=>{let n;function r(){n&&clearTimeout(n),n=setTimeout(()=>{t.parent.classList.add("bespoke-marp-inactive")},e),t.parent.classList.remove("bespoke-marp-inactive")}document.addEventListener("mousedown",r),document.addEventListener("mousemove",r),document.addEventListener("touchend",r),setTimeout(r,0)}}const r=["AUDIO","BUTTON","INPUT","SELECT","TEXTAREA","VIDEO"];function s(e){e.parent.addEventListener("keydown",e=>{if(!e.target)return;const t=e.target;(r.includes(t.nodeName)||"true"===t.contentEditable)&&e.stopPropagation()})}function o(e){window.addEventListener("load",()=>{for(const t of e.slides){const e=t.querySelector("[data-marp-fitting]")?"":"hideable";t.setAttribute("data-bespoke-marp-load",e)}})}function a(e){let t=0,n=0;Object.defineProperty(e,"fragments",{enumerable:!0,value:e.slides.map(e=>[null,...e.querySelectorAll("[data-marpit-fragment]")])});const r=r=>void 0!==e.fragments[t][n+r],s=(r,s)=>{t=r,n=s,e.fragments.forEach((e,t)=>{e.forEach((e,n)=>{if(null==e)return;const o=t<r||t===r&&n<=s;e.setAttribute("data-bespoke-marp-fragment",o?"active":"inactive"),t===r&&n===s?e.setAttribute("data-bespoke-marp-current-fragment","current"):e.removeAttribute("data-bespoke-marp-current-fragment")})}),e.fragmentIndex=s;const o={slide:e.slides[r],index:r,fragments:e.fragments[r],fragmentIndex:s};e.fire("fragment",o)};e.on("next",()=>{if(r(1))return s(t,n+1),!1;const o=t+1;e.fragments[o]&&s(o,0)}),e.on("prev",()=>{if(r(-1))return s(t,n-1),!1;const o=t-1;e.fragments[o]&&s(o,e.fragments[o].length-1)}),e.on("slide",({index:t,fragment:n})=>{let r=0;if(void 0!==n){const s=e.fragments[t];if(s){const{length:e}=s;r=-1===n?e-1:Math.min(Math.max(n,0),e-1)}}s(t,r)}),s(0,0)}var i,l=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){
/*!
  * screenfull
  * v5.0.0 - 2019-09-09
  * (c) Sindre Sorhus; MIT License
  */
!function(){var t="undefined"!=typeof window&&void 0!==window.document?window.document:{},n=e.exports,r=function(){for(var e,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,s=n.length,o={};r<s;r++)if((e=n[r])&&e[1]in t){for(r=0;r<e.length;r++)o[n[0][r]]=e[r];return o}return!1}(),s={change:r.fullscreenchange,error:r.fullscreenerror},o={request:function(e){return new Promise(function(n,s){var o=function(){this.off("change",o),n()}.bind(this);this.on("change",o),e=e||t.documentElement,Promise.resolve(e[r.requestFullscreen]()).catch(s)}.bind(this))},exit:function(){return new Promise(function(e,n){if(this.isFullscreen){var s=function(){this.off("change",s),e()}.bind(this);this.on("change",s),Promise.resolve(t[r.exitFullscreen]()).catch(n)}else e()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,n){var r=s[e];r&&t.addEventListener(r,n,!1)},off:function(e,n){var r=s[e];r&&t.removeEventListener(r,n,!1)},raw:r};r?(Object.defineProperties(o,{isFullscreen:{get:function(){return Boolean(t[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[r.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(t[r.fullscreenEnabled])}}}),n?e.exports=o:window.screenfull=o):n?e.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}()}));l.isEnabled;function c(e){e.fullscreen=()=>{l.isEnabled&&l.toggle(document.body)},document.addEventListener("keydown",t=>{70!==t.which&&122!==t.which||t.altKey||t.ctrlKey||t.metaKey||!l.isEnabled||(e.fullscreen(),t.preventDefault())})}function d(e={}){const t=Object.assign({interval:200},e);return e=>{document.addEventListener("keydown",t=>{(32===t.which&&t.shiftKey||33===t.which||37===t.which||38===t.which)&&e.prev(),(32===t.which&&!t.shiftKey||34===t.which||39===t.which||40===t.which)&&e.next(),35===t.which&&e.slide(e.slides.length-1,{fragment:-1}),36===t.which&&e.slide(0)});let n,r,s=0;e.parent.addEventListener("wheel",o=>{let a=!1;const l=(e,t)=>{var n;e&&(a=a||function(e,t){return function(e,t){const n=t===i.X?"Width":"Height";return e[`client${n}`]<e[`scroll${n}`]}(e,t)&&function(e,t){const{overflow:n}=e,r=e[`overflow${t}`];return"auto"===n||"scroll"===n||"auto"===r||"scroll"===r}(getComputedStyle(e),t)}(e,t)),(null===(n=e)||void 0===n?void 0:n.parentElement)&&l(e.parentElement,t)};if(0!==o.deltaX&&l(o.target,i.X),0!==o.deltaY&&l(o.target,i.Y),a)return;o.preventDefault(),r&&clearTimeout(r),r=setTimeout(()=>{n=0},t.interval);const c=Date.now()-s<t.interval,d=Math.sqrt(Math.pow(o.deltaX,2)+Math.pow(o.deltaY,2)),u=d<=n;if(n=d,c||u)return;let f;(o.deltaX>0||o.deltaY>0)&&(f="next"),(o.deltaX<0||o.deltaY<0)&&(f="prev"),f&&(e[f](),s=Date.now())})}}function u(e=".bespoke-marp-osc"){const t=document.querySelector(e);if(!t)return()=>{};const n=(e,n)=>{t.querySelectorAll(`[data-bespoke-marp-osc=${JSON.stringify(e)}]`).forEach(n)};return l.isEnabled||n("fullscreen",e=>e.style.display="none"),e=>{t.addEventListener("click",t=>{if(t.target instanceof HTMLElement){const{bespokeMarpOsc:n}=t.target.dataset;switch(n&&t.target.blur(),n){case"next":e.next();break;case"prev":e.prev();break;case"fullscreen":"function"==typeof e.fullscreen&&l.isEnabled&&e.fullscreen();break;case"presenter":e.openPresenterView()}}}),e.parent.appendChild(t),e.on("activate",({index:t})=>{n("page",n=>n.textContent=`Page ${t+1} of ${e.slides.length}`)}),e.on("fragment",({index:t,fragments:r,fragmentIndex:s})=>{n("prev",e=>e.disabled=0===t&&0===s),n("next",n=>n.disabled=t===e.slides.length-1&&s===r.length-1)}),l.isEnabled&&l.onchange(()=>n("fullscreen",e=>e.classList.toggle("exit",l.isEnabled&&l.isFullscreen)))}}!function(e){e.X="X",e.Y="Y"}(i||(i={}));const f=(...e)=>history.replaceState(...e);var m;!function(e){e.Normal="",e.Presenter="presenter",e.Next="next"}(m||(m={}));const p=(e,{protocol:t,host:n,pathname:r,hash:s}=location)=>{const o=e.toString();return`${t}//${n}${r}${o?"?":""}${o}${s}`},h=()=>{switch(document.body.getAttribute("data-bespoke-view")){case m.Normal:return m.Normal;case m.Presenter:return m.Presenter;case m.Next:return m.Next;default:throw new Error("View mode is not assigned.")}},g=e=>new URLSearchParams(location.search).get(e),b=(e,t={})=>{const n=Object.assign({location:location,setter:f},t),r=new URLSearchParams(n.location.search);for(const t of Object.keys(e)){const n=e[t];"string"==typeof n?r.set(t,n):r.delete(t)}try{n.setter(null,document.title,p(r,n.location))}catch(e){console.error(e)}};function v(){const e=Math.max(Math.floor(.85*window.innerWidth),640),t=Math.max(Math.floor(.85*window.innerHeight),360);return window.open(this.presenterUrl,`bespoke-marp-presenter-${this.syncKey}`,`width=${e},height=${t},menubar=no,toolbar=no`)}function w(){const e=new URLSearchParams(location.search);return e.set("view","presenter"),e.set("sync",this.syncKey),p(e)}var x=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];let y=e=>String(e).replace(/[&<>"']/g,e=>`&${E[e]};`),E={"&":"amp","<":"lt",">":"gt",'"':"quot","'":"apos"},k="dangerouslySetInnerHTML",L={className:"class",htmlFor:"for"},S={};function P(e,t){let n=[],r="";t=t||{};for(let e=arguments.length;e-- >2;)n.push(arguments[e]);if("function"==typeof e)return t.children=n.reverse(),e(t);if(e){if(r+="<"+e,t)for(let e in t)!1!==t[e]&&null!=t[e]&&e!==k&&(r+=` ${L[e]?L[e]:y(e)}="${y(t[e])}"`);r+=">"}if(-1===x.indexOf(e)){if(t[k])r+=t[k].__html;else for(;n.length;){let e=n.pop();if(e)if(e.pop)for(let t=e.length;t--;)n.push(e[t]);else r+=!0===S[e]?e:y(e)}r+=e?`</${e}>`:""}return S[r]=!0,r}const I=({children:e})=>P(null,null,...e),M="bespoke-marp-presenter-container",N="bespoke-marp-presenter-next",$="bespoke-marp-presenter-next-container",F="bespoke-marp-presenter-note-container",O="bespoke-marp-presenter-info-container",T="bespoke-marp-presenter-info-page",q="bespoke-marp-presenter-info-page-text",C="bespoke-marp-presenter-info-page-prev",j="bespoke-marp-presenter-info-page-next",A="bespoke-marp-presenter-info-time",K="bespoke-marp-presenter-info-timer";function R(e){const{title:t}=document;document.title=`[Presenter view]${t?` - ${t}`:""}`;const n={},r=e=>(n[e]=n[e]||document.querySelector(`.${e}`),n[e]);document.body.appendChild((e=>{const t=document.createElement("div");return t.className=M,t.appendChild(e),t.insertAdjacentHTML("beforeend",P(I,null,P("div",{class:$},P("iframe",{class:N,src:"?view=next"})),P("div",{class:F}),P("div",{class:O},P("div",{class:T},P("button",{class:C,tabindex:"-1",title:"Previous"},"Previous"),P("span",{class:q}),P("button",{class:j,tabindex:"-1",title:"Next"},"Next")),P("time",{class:A,title:"Current time"}),P("div",{class:K})))),t})(e.parent)),(e=>{r($).addEventListener("click",()=>e.next());const t=r(N),n=(s=t,(e,t)=>s.contentWindow.postMessage(`navigate:${e},${t}`,"null"===window.origin?"*":window.origin));var s;t.addEventListener("load",()=>{r($).classList.add("active"),n(e.slide(),e.fragmentIndex),e.on("fragment",({index:e,fragmentIndex:t})=>n(e,t))});const o=document.querySelectorAll(".bespoke-marp-note");o.forEach(e=>{e.addEventListener("keydown",e=>e.stopPropagation()),r(F).appendChild(e)}),e.on("activate",()=>o.forEach(t=>t.classList.toggle("active",t.dataset.index==e.slide()))),e.on("activate",({index:t})=>{r(q).textContent=`${t+1} / ${e.slides.length}`});const a=r(C),i=r(j);a.addEventListener("click",()=>{a.blur(),e.prev()}),i.addEventListener("click",()=>{i.blur(),e.next()}),e.on("fragment",({index:t,fragments:n,fragmentIndex:r})=>{a.disabled=0===t&&0===r,i.disabled=t===e.slides.length-1&&r===n.length-1});const l=()=>r(A).textContent=(new Date).toLocaleTimeString();l(),setInterval(l,250)})(e)}function V(e){const t=h();return t===m.Next&&e.appendChild(document.createElement("span")),e=>{t===m.Normal&&function(e){if(!(e=>e.syncKey&&"string"==typeof e.syncKey)(e))throw new Error("The current instance of Bespoke.js is invalid for Marp bespoke presenter plugin.");Object.defineProperties(e,{openPresenterView:{enumerable:!0,value:v},presenterUrl:{enumerable:!0,get:w}}),document.addEventListener("keydown",t=>{80!==t.which||t.altKey||t.ctrlKey||t.metaKey||(t.preventDefault(),e.openPresenterView())})}(e),t===m.Presenter&&R(e),t===m.Next&&function(e){const t=t=>{if(t.origin!==window.origin)return;const[n,r]=t.data.split(":");if("navigate"===n){const[t,n]=r.split(",");e.slide(Number.parseInt(t,10),{fragment:Number.parseInt(n,10)}),e.next()}};window.addEventListener("message",t),e.on("destroy",()=>window.removeEventListener("message",t))}(e)}}function X(e){e.on("activate",t=>{document.querySelectorAll(".bespoke-progress-bar").forEach(n=>{n.style.flexBasis=`${100*t.index/(e.slides.length-1)}%`})})}const D=e=>{const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t};function U(e={}){const t=Object.assign({history:!0},e);return e=>{let n=!0;const r=e=>{const t=n;try{return n=!0,e()}finally{n=t}},s=(t={fragment:!0})=>{((t,n)=>{const{fragments:r,slides:s}=e,o=Math.max(0,Math.min(t,s.length-1)),a=Math.max(0,Math.min(n||0,r[o].length-1));o===e.slide()&&a===e.fragmentIndex||e.slide(o,{fragment:a})})((D(location.hash.slice(1))||1)-1,t.fragment?D(g("f")||""):null)};e.on("fragment",({index:e,fragmentIndex:r})=>{n||b({f:0===r||r.toString()},{location:Object.assign(Object.assign({},location),{hash:`#${e+1}`}),setter:(...e)=>t.history?history.pushState(...e):history.replaceState(...e)})}),setTimeout(()=>{s(),window.addEventListener("hashchange",()=>r(()=>{s({fragment:!1}),b({f:void 0})})),window.addEventListener("popstate",()=>{n||r(()=>s())}),n=!1},0)}}var Y=self.crypto||self.msCrypto;function B(e={}){const t=e.key||function(e){e=e||21;for(var t="",n=Y.getRandomValues(new Uint8Array(e));e--;)t+="QLUint8ARdomValuesObj0h6345-79BCrypgJzHKTNYDSMkXPZ_FfG1WcqvwxEI2"[63&n[e]];return t}(),n=`bespoke-marp-sync-${t}`,r=()=>{const e=localStorage.getItem(n);return e?JSON.parse(e):Object.create(null)},s=e=>{const t=r(),s=Object.assign(Object.assign({},t),e(t));return localStorage.setItem(n,JSON.stringify(s)),s};return s(e=>({reference:(e.reference||0)+1})),e=>{Object.defineProperty(e,"syncKey",{value:t,enumerable:!0});let o=!0;setTimeout(()=>{e.on("fragment",e=>{o&&s(()=>({index:e.index,fragmentIndex:e.fragmentIndex}))})},0),window.addEventListener("storage",t=>{if(t.key===n&&t.oldValue&&t.newValue){const n=JSON.parse(t.oldValue),r=JSON.parse(t.newValue);if(n.index!==r.index||n.fragmentIndex!==r.fragmentIndex)try{o=!1,e.slide(r.index,{fragment:r.fragmentIndex})}finally{o=!0}}}),e.on("destroy",()=>{const{reference:e}=r();void 0===e||e<=1?localStorage.removeItem(n):s(()=>({reference:e-1}))})}}function z(e={}){const t=Object.assign({slope:Math.tan(-35*Math.PI/180),swipeThreshold:30},e);return e=>{let n;const r=e.parent,s=e=>{const t=r.getBoundingClientRect();return{x:e.pageX-(t.left+t.right)/2,y:e.pageY-(t.top+t.bottom)/2}};r.addEventListener("touchstart",e=>{n=1===e.touches.length?s(e.touches[0]):void 0}),r.addEventListener("touchmove",e=>{if(n)if(1===e.touches.length){e.preventDefault();const t=s(e.touches[0]),r=t.x-n.x,o=t.y-n.y;n.delta=Math.sqrt(Math.pow(Math.abs(r),2)+Math.pow(Math.abs(o),2)),n.radian=Math.atan2(r,o)}else n=void 0}),r.addEventListener("touchend",r=>{if(n){if(n.delta&&n.delta>=t.swipeThreshold){let s=n.radian-t.slope;s=(s+Math.PI)%(2*Math.PI)-Math.PI,e[s<0?"next":"prev"](),r.stopPropagation()}n=void 0}})}}const H=[m.Normal,m.Presenter,m.Next];!function(r=document.getElementById("p")){document.body.setAttribute("data-bespoke-view",(()=>{switch(g("view")){case"next":return m.Next;case"presenter":return m.Presenter;default:return m.Normal}})());const i=(e=>{const t=g(e);return b({[e]:void 0}),t})("sync")||void 0,l=!1,f=!0,p=e(r,((...e)=>{const t=H.findIndex(e=>h()===e);if(t<0)throw new Error("Invalid view");return e.map(([e,n])=>e[t]&&n).filter(e=>e)})([[f,f,l],B({key:i})],[[f,f,f],V(r)],[[f,f,l],s],[[f,f,f],t],[[f,l,l],n()],[[f,f,f],o],[[f,f,f],U({history:!1})],[[f,f,l],d()],[[f,f,l],c],[[f,l,l],X],[[f,f,l],z()],[[f,l,l],u()],[[f,f,f],a]));window.addEventListener("beforeunload",()=>b({sync:p.syncKey})),window.addEventListener("unload",()=>p.destroy())}()}();
</script></body></html>